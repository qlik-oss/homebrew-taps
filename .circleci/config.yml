version: 2.1

jobs:
  publish: # This job will be triggered by a remote repository.
    working_directory: ~/homebrew-taps
    docker:
      - image: circleci/golang:1.14
    steps:
      - checkout
      - run:
          name: Pull releases and patch formula
          command: go run publish.go
      - run:
          name: Commit changes
          command: |
            (git diff --quiet --exit-code && echo "No changes found") || \\
              (git add -A && \
              git commit -m "Publish qlik-cli release" && \
              git push)
